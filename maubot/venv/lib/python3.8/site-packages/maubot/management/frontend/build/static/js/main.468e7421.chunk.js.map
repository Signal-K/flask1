{"version":3,"sources":["components/PrivateRoute.js","components/Spinner.js","api.js","res/plus.svg","res/chevron-right.svg","res/bot.svg","components/Switch.js","components/PreferenceTable.js","pages/dashboard/BaseMainView.js","res/chevron-left.svg","res/sort-down.svg","res/sort-up.svg","pages/dashboard/InstanceDatabase.js","pages/dashboard/Instance.js","res/upload.svg","pages/dashboard/Client.js","pages/dashboard/Plugin.js","pages/dashboard/Home.js","pages/dashboard/Modal.js","pages/dashboard/Log.js","pages/dashboard/index.js","pages/Login.js","pages/Main.js","index.js"],"names":["PrivateRoute","component","render","authed","to","args","props","React","createElement","pathname","Spinner","className","viewBox","cx","cy","r","fill","strokeWidth","strokeMiterlimit","BASE_PATH","getHeaders","contentType","localStorage","accessToken","async","defaultDelete","type","id","resp","fetch","headers","method","status","json","defaultPut","entry","suffix","body","JSON","stringify","defaultGet","path","features","remoteGetFeatures","_debugOpenFileEnabled","undefined","login","username","password","ping","response","errcode","setBasePath","basePath","getFeatures","openLogSocket","url","window","location","protocol","host","wrapper","socket","connected","authenticated","onLog","data","onHistory","history","fails","openHandler","send","messageHandler","evt","parse","auth_success","console","info","closeHandler","code","error","setTimeout","WebSocket","onopen","onmessage","onclose","Math","min","debugOpenFile","line","debugOpenFileEnabled","updateDebugOpenFileEnabled","getInstances","getInstance","putInstance","instance","deleteInstance","getInstanceDatabase","queryInstanceDatabase","query","getPlugins","getPlugin","uploadPlugin","deletePlugin","getClients","getClient","uploadAvatar","mime","getAvatarURL","avatar_url","startsWith","substr","length","putClient","client","deleteClient","clearClientCache","getClientAuthServers","doClientAuth","server","_extends","Object","assign","target","i","arguments","source","key","prototype","hasOwnProperty","call","apply","this","_ref","d","SvgPlus","svgRef","title","width","height","ref","ForwardRef","forwardRef","_ref2","SvgChevronRight","SvgBot","Switch","Component","constructor","super","toggle","onToggle","state","active","setState","toggleKeyboard","componentWillReceiveProps","nextProps","data-active","onClick","tabIndex","onKeyPress","onText","offText","PrefTable","children","wrapperClass","PrefRow","name","fullWidth","labelFor","changed","htmlFor","PrefInput","rowName","value","origValue","PrefSwitch","origActive","PrefSelect","creatable","BaseMainView","delete","confirm","deleting","deleteFunc","success","push","onDelete","inputChange","event","renderInstances","isNew","hasInstances","instances","map","renderLogButton","filter","api","log","openLog","initialState","newState","entryKeys","file","Promise","resolve","reject","reader","FileReader","readAsArrayBuffer","onload","result","onerror","err","SvgChevronLeft","SvgSortDown","SvgSortUp","Map","func","res","InstanceDatabase","reloadContent","resetContent","loading","instanceID","prevQuery","rowCount","insertedPrimaryKey","ok","rows","header","columns","content","rowcount","buildSQLQuery","selectedTable","deleteRow","_","values","row","keys","condition","index","entries","val","sqlEscape","toString","join","editCell","collectContextMeta","col","str","replace","char","renderTable","column","toggleSort","getColumnType","getColumnInfo","getSortIcon","rowIndex","cell","colIndex","renderTag","collect","disabled","tables","order","table","columnName","sort","checkLocationTable","componentDidUpdate","prevProps","prefix","getSortQueryParams","Array","from","reverse","size","oldSort","get","set","primary","unique","renderContent","tbl","onChange","withRouter","Instance","clientSelectEntry","label","getAvatarMXC","src","alt","displayname","remote_displayname","save","saving","instanceInState","renderDatabase","renderMain","placeholder","enabled","started","options","clientOptions","isSearchable","selectedClientEntry","primary_user","plugin","typeOptions","selectedPluginEntry","Boolean","base_config","mode","theme","config","editorProps","fontSize","$blockScrolling","isValid","database","updateClientOptions","remote_avatar_url","ctx","clients","plugins","ListEntry","SvgUpload","Client","homeserverEntry","serverName","serverURL","avatarUpload","files","uploadingAvatar","readFile","content_uri","clientInState","startOrStop","startingOrStopping","clearCache","clearingCache","renderStartedContainer","text","sync_ok","renderSidebar","avatarMXC","avatarURL","accept","onDragEnter","parentElement","classList","add","onDragLeave","remove","renderPreferences","client_auth","homeserverOptions","selectedHomeserver","homeserver","isValidNewOption","isValidHomeserver","access_token","sync","autojoin","online","renderPrefButtons","homeserversByURL","updateHomeserverOptions","homeserversByName","URL","classes","Plugin","upload","version","uploading","plugin_upload","Home","Modal","open","close","isOpen","clientWidth","stopPropagation","Context","Provider","createContext","LogEntry","PureComponent","renderName","nameLink","modal","context","matrix_http_request","req","hideRoot","msg","onClickOpen","renderTimeTitle","time","toDateString","renderTime","href","lineno","toLocaleTimeString","renderLevelName","levelname","focus","renderRow","toLowerCase","unfocused","renderExceptionInfo","exc_info","fileLinks","part","split","Fragment","pop","contextType","Log","linesRef","createRef","linesBottomRef","getSnapshotBeforeUpdate","current","isVisible","_1","_2","wasVisible","scrollParentToChild","componentDidMount","parent","child","parentRect","getBoundingClientRect","childRect","scrollBy","top","scrollTop","clientHeight","lines","Dashboard","logFocus","logModal","renderNotFound","thing","renderDisabled","sidebarOpen","modalOpen","logLines","maubot","instanceList","clientList","pluginList","homeservers","all","enableLogs","logs","processEntry","Date","concat","renderList","field","stateField","oldID","renderView","typeName","slice","newEntry","exact","match","params","renderModal","Login","inputChanged","preventDefault","token","onLogin","onSubmit","Main","pinged","getBasePath","process","apiPath","api_path","ReactDOM","document","getElementById"],"mappings":"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","file":"static/js/main.468e7421.chunk.js","sourcesContent":["// maubot - A plugin-based Matrix bot system.\n// Copyright (C) 2019 Tulir Asokan\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\nimport React from \"react\"\nimport { Route, Redirect } from \"react-router-dom\"\n\nconst PrivateRoute = ({ component, render, authed, to = \"/login\", ...args }) => (\n    <Route\n        {...args}\n        render={(props) => authed === true\n            ? (component ? React.createElement(component, props) : render())\n            : <Redirect to={{ pathname: to }}/>}\n    />\n)\n\nexport default PrivateRoute\n","import React from \"react\"\n\nconst Spinner = (props) => (\n    <div {...props} className={`spinner ${props[\"className\"] || \"\"}`}>\n        <svg viewBox=\"25 25 50 50\">\n            <circle cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" strokeWidth=\"2\" strokeMiterlimit=\"10\"/>\n        </svg>\n    </div>\n)\n\nexport default Spinner\n","// maubot - A plugin-based Matrix bot system.\n// Copyright (C) 2019 Tulir Asokan\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nlet BASE_PATH = \"/_matrix/maubot/v1\"\n\nexport function setBasePath(basePath) {\n    BASE_PATH = basePath\n}\n\nfunction getHeaders(contentType = \"application/json\") {\n    return {\n        \"Content-Type\": contentType,\n        \"Authorization\": `Bearer ${localStorage.accessToken}`,\n    }\n}\n\nasync function defaultDelete(type, id) {\n    const resp = await fetch(`${BASE_PATH}/${type}/${id}`, {\n        headers: getHeaders(),\n        method: \"DELETE\",\n    })\n    if (resp.status === 204) {\n        return {\n            \"success\": true,\n        }\n    }\n    return await resp.json()\n}\n\nasync function defaultPut(type, entry, id = undefined, suffix = undefined) {\n    const resp = await fetch(`${BASE_PATH}/${type}/${id || entry.id}${suffix || \"\"}`, {\n        headers: getHeaders(),\n        body: JSON.stringify(entry),\n        method: \"PUT\",\n    })\n    return await resp.json()\n}\n\nasync function defaultGet(path) {\n    const resp = await fetch(`${BASE_PATH}${path}`, { headers: getHeaders() })\n    return await resp.json()\n}\n\nexport async function login(username, password) {\n    const resp = await fetch(`${BASE_PATH}/auth/login`, {\n        method: \"POST\",\n        body: JSON.stringify({\n            username,\n            password,\n        }),\n    })\n    return await resp.json()\n}\n\nlet features = null\n\nexport async function ping() {\n    const response = await fetch(`${BASE_PATH}/auth/ping`, {\n        method: \"POST\",\n        headers: getHeaders(),\n    })\n    const json = await response.json()\n    if (json.username) {\n        features = json.features\n        return json.username\n    } else if (json.errcode === \"auth_token_missing\" || json.errcode === \"auth_token_invalid\") {\n        if (!features) {\n            await remoteGetFeatures()\n        }\n        return null\n    }\n    throw json\n}\n\nexport const remoteGetFeatures = async () => {\n    features = await defaultGet(\"/features\")\n}\n\nexport const getFeatures = () => features\n\nexport async function openLogSocket() {\n    let protocol = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\"\n    const url = `${protocol}//${window.location.host}${BASE_PATH}/logs`\n    const wrapper = {\n        socket: null,\n        connected: false,\n        authenticated: false,\n        onLog: data => undefined,\n        onHistory: history => undefined,\n        fails: -1,\n    }\n    const openHandler = () => {\n        wrapper.socket.send(localStorage.accessToken)\n        wrapper.connected = true\n    }\n    const messageHandler = evt => {\n        // TODO use logs\n        const data = JSON.parse(evt.data)\n        if (data.auth_success !== undefined) {\n            if (data.auth_success) {\n                console.info(\"Websocket connection authentication successful\")\n                wrapper.authenticated = true\n                wrapper.fails = -1\n            } else {\n                console.info(\"Websocket connection authentication failed\")\n            }\n        } else if (data.history) {\n            wrapper.onHistory(data.history)\n        } else {\n            wrapper.onLog(data)\n        }\n    }\n    const closeHandler = evt => {\n        if (evt) {\n            if (evt.code === 4000) {\n                console.error(\"Websocket connection failed: access token invalid or not provided\")\n            } else if (evt.code === 1012) {\n                console.info(\"Websocket connection closed: server is restarting\")\n            }\n        }\n        wrapper.connected = false\n        wrapper.socket = null\n        wrapper.fails++\n        const SECOND = 1000\n        setTimeout(() => {\n            wrapper.socket = new WebSocket(url)\n            wrapper.socket.onopen = openHandler\n            wrapper.socket.onmessage = messageHandler\n            wrapper.socket.onclose = closeHandler\n        }, Math.min(wrapper.fails * 5 * SECOND, 30 * SECOND))\n    }\n\n    closeHandler()\n\n    return wrapper\n}\n\nlet _debugOpenFileEnabled = undefined\nexport const debugOpenFileEnabled = () => _debugOpenFileEnabled\nexport const updateDebugOpenFileEnabled = async () => {\n    const resp = await defaultGet(\"/debug/open\")\n    _debugOpenFileEnabled = resp[\"enabled\"] || false\n}\n\nexport async function debugOpenFile(path, line) {\n    const resp = await fetch(`${BASE_PATH}/debug/open`, {\n        headers: getHeaders(),\n        body: JSON.stringify({ path, line }),\n        method: \"POST\",\n    })\n    return await resp.json()\n}\n\nexport const getInstances = () => defaultGet(\"/instances\")\nexport const getInstance = id => defaultGet(`/instance/${id}`)\nexport const putInstance = (instance, id) => defaultPut(\"instance\", instance, id)\nexport const deleteInstance = id => defaultDelete(\"instance\", id)\n\nexport const getInstanceDatabase = id => defaultGet(`/instance/${id}/database`)\nexport const queryInstanceDatabase = async (id, query) => {\n    const resp = await fetch(`${BASE_PATH}/instance/${id}/database/query`, {\n        headers: getHeaders(),\n        body: JSON.stringify({ query }),\n        method: \"POST\",\n    })\n    return await resp.json()\n}\n\nexport const getPlugins = () => defaultGet(\"/plugins\")\nexport const getPlugin = id => defaultGet(`/plugin/${id}`)\nexport const deletePlugin = id => defaultDelete(\"plugin\", id)\n\nexport async function uploadPlugin(data, id) {\n    let resp\n    if (id) {\n        resp = await fetch(`${BASE_PATH}/plugin/${id}`, {\n            headers: getHeaders(\"application/zip\"),\n            body: data,\n            method: \"PUT\",\n        })\n    } else {\n        resp = await fetch(`${BASE_PATH}/plugins/upload`, {\n            headers: getHeaders(\"application/zip\"),\n            body: data,\n            method: \"POST\",\n        })\n    }\n    return await resp.json()\n}\n\nexport const getClients = () => defaultGet(\"/clients\")\nexport const getClient = id => defaultGet(`/clients/${id}`)\n\nexport async function uploadAvatar(id, data, mime) {\n    const resp = await fetch(`${BASE_PATH}/proxy/${id}/_matrix/media/r0/upload`, {\n        headers: getHeaders(mime),\n        body: data,\n        method: \"POST\",\n    })\n    return await resp.json()\n}\n\nexport function getAvatarURL({ id, avatar_url }) {\n    avatar_url = avatar_url || \"\"\n    if (avatar_url.startsWith(\"mxc://\")) {\n        avatar_url = avatar_url.substr(\"mxc://\".length)\n    }\n    return `${BASE_PATH}/proxy/${id}/_matrix/media/r0/download/${avatar_url}?access_token=${\n        localStorage.accessToken}`\n}\n\nexport const putClient = client => defaultPut(\"client\", client)\nexport const deleteClient = id => defaultDelete(\"client\", id)\n\nexport async function clearClientCache(id) {\n    const resp = await fetch(`${BASE_PATH}/client/${id}/clearcache`, {\n        headers: getHeaders(),\n        method: \"POST\",\n    })\n    return await resp.json()\n}\n\nexport const getClientAuthServers = () => defaultGet(\"/client/auth/servers\")\n\nexport async function doClientAuth(server, type, username, password) {\n    const resp = await fetch(`${BASE_PATH}/client/auth/${server}/${type}`, {\n        headers: getHeaders(),\n        body: JSON.stringify({ username, password }),\n        method: \"POST\",\n    })\n    return await resp.json()\n}\n\nexport default {\n    login, ping, setBasePath, getFeatures, remoteGetFeatures,\n    openLogSocket,\n    debugOpenFile, debugOpenFileEnabled, updateDebugOpenFileEnabled,\n    getInstances, getInstance, putInstance, deleteInstance,\n    getInstanceDatabase, queryInstanceDatabase,\n    getPlugins, getPlugin, uploadPlugin, deletePlugin,\n    getClients, getClient, uploadAvatar, getAvatarURL, putClient, deleteClient, clearClientCache,\n    getClientAuthServers, doClientAuth,\n}\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from \"react\";\n\nvar _ref = /*#__PURE__*/React.createElement(\"path\", {\n  fill: \"#000000\",\n  d: \"M17,13H13V17H11V13H7V11H11V7H13V11H17M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z\"\n});\n\nconst SvgPlus = ({\n  svgRef,\n  title,\n  ...props\n}) => /*#__PURE__*/React.createElement(\"svg\", _extends({\n  width: 24,\n  height: 24,\n  viewBox: \"0 0 24 24\",\n  ref: svgRef\n}, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref);\n\nconst ForwardRef = /*#__PURE__*/React.forwardRef((props, ref) => /*#__PURE__*/React.createElement(SvgPlus, _extends({\n  svgRef: ref\n}, props)));\nexport default __webpack_public_path__ + \"static/media/plus.18514313.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from \"react\";\n\nvar _ref = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z\"\n});\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M0 0h24v24H0z\",\n  fill: \"none\"\n});\n\nconst SvgChevronRight = ({\n  svgRef,\n  title,\n  ...props\n}) => /*#__PURE__*/React.createElement(\"svg\", _extends({\n  width: 24,\n  height: 24,\n  viewBox: \"0 0 24 24\",\n  ref: svgRef\n}, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref, _ref2);\n\nconst ForwardRef = /*#__PURE__*/React.forwardRef((props, ref) => /*#__PURE__*/React.createElement(SvgChevronRight, _extends({\n  svgRef: ref\n}, props)));\nexport default __webpack_public_path__ + \"static/media/chevron-right.b6b6c4db.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from \"react\";\n\nvar _ref = /*#__PURE__*/React.createElement(\"path\", {\n  fill: \"#000000\",\n  d: \"M12,2A2,2 0 0,1 14,4C14,4.74 13.6,5.39 13,5.73V7H14A7,7 0 0,1 21,14H22A1,1 0 0,1 23,15V18A1,1 0 0,1 22,19H21V20A2,2 0 0,1 19,22H5A2,2 0 0,1 3,20V19H2A1,1 0 0,1 1,18V15A1,1 0 0,1 2,14H3A7,7 0 0,1 10,7H11V5.73C10.4,5.39 10,4.74 10,4A2,2 0 0,1 12,2M7.5,13A2.5,2.5 0 0,0 5,15.5A2.5,2.5 0 0,0 7.5,18A2.5,2.5 0 0,0 10,15.5A2.5,2.5 0 0,0 7.5,13M16.5,13A2.5,2.5 0 0,0 14,15.5A2.5,2.5 0 0,0 16.5,18A2.5,2.5 0 0,0 19,15.5A2.5,2.5 0 0,0 16.5,13Z\"\n});\n\nconst SvgBot = ({\n  svgRef,\n  title,\n  ...props\n}) => /*#__PURE__*/React.createElement(\"svg\", _extends({\n  width: 24,\n  height: 24,\n  viewBox: \"0 0 24 24\",\n  ref: svgRef\n}, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref);\n\nconst ForwardRef = /*#__PURE__*/React.forwardRef((props, ref) => /*#__PURE__*/React.createElement(SvgBot, _extends({\n  svgRef: ref\n}, props)));\nexport default __webpack_public_path__ + \"static/media/bot.33906f18.svg\";\nexport { ForwardRef as ReactComponent };","// maubot - A plugin-based Matrix bot system.\n// Copyright (C) 2019 Tulir Asokan\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\nimport React, { Component } from \"react\"\n\nclass Switch extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            active: props.active,\n        }\n    }\n\n    componentWillReceiveProps(nextProps) {\n        this.setState({\n            active: nextProps.active,\n        })\n    }\n\n    toggle = () => {\n        if (this.props.onToggle) {\n            this.props.onToggle(!this.state.active)\n        } else {\n            this.setState({ active: !this.state.active })\n        }\n    }\n\n    toggleKeyboard = evt => (evt.key === \" \" || evt.key === \"Enter\") && this.toggle()\n\n    render() {\n        return (\n            <div className=\"switch\" data-active={this.state.active} onClick={this.toggle}\n                 tabIndex=\"0\" onKeyPress={this.toggleKeyboard} id={this.props.id}>\n                <div className=\"box\">\n                    <span className=\"text\">\n                        <span className=\"on\">{this.props.onText || \"On\"}</span>\n                        <span className=\"off\">{this.props.offText || \"Off\"}</span>\n                    </span>\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default Switch\n","// maubot - A plugin-based Matrix bot system.\n// Copyright (C) 2019 Tulir Asokan\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\nimport React from \"react\"\nimport Select from \"react-select\"\nimport CreatableSelect from \"react-select/creatable\"\nimport Switch from \"./Switch\"\n\nexport const PrefTable = ({ children, wrapperClass }) => {\n    if (wrapperClass) {\n        return (\n            <div className={wrapperClass}>\n                <div className=\"preference-table\">\n                    {children}\n                </div>\n            </div>\n        )\n    }\n    return (\n        <div className=\"preference-table\">\n            {children}\n        </div>\n    )\n}\n\nexport const PrefRow =\n    ({ name, fullWidth = false, labelFor = undefined, changed = false, children }) => (\n        <div className={`entry ${fullWidth ? \"full-width\" : \"\"} ${changed ? \"changed\" : \"\"}`}>\n            <label htmlFor={labelFor}>{name}</label>\n            <div className=\"value\">{children}</div>\n        </div>\n    )\n\nexport const PrefInput = ({ rowName, value, origValue, fullWidth = false, ...args }) => (\n    <PrefRow name={rowName} fullWidth={fullWidth} labelFor={rowName}\n             changed={origValue !== undefined && value !== origValue}>\n        <input {...args} value={value} id={rowName}/>\n    </PrefRow>\n)\n\nexport const PrefSwitch = ({ rowName, active, origActive, fullWidth = false, ...args }) => (\n    <PrefRow name={rowName} fullWidth={fullWidth} labelFor={rowName}\n             changed={origActive !== undefined && active !== origActive}>\n        <Switch {...args} active={active} id={rowName}/>\n    </PrefRow>\n)\n\nexport const PrefSelect = ({ rowName, value, origValue, fullWidth = false, creatable = false, ...args }) => (\n    <PrefRow name={rowName} fullWidth={fullWidth} labelFor={rowName}\n             changed={origValue !== undefined && value.id !== origValue}>\n        {creatable\n            ? <CreatableSelect className=\"select\" {...args} id={rowName} value={value}/>\n            : <Select className=\"select\" {...args} id={rowName} value={value}/>}\n    </PrefRow>\n)\n\nexport default PrefTable\n","import React, { Component } from \"react\"\nimport { Link } from \"react-router-dom\"\nimport api from \"../../api\"\n\nclass BaseMainView extends Component {\n    constructor(props) {\n        super(props)\n        this.state = Object.assign(this.initialState, props.entry)\n    }\n\n    componentWillReceiveProps(nextProps) {\n        const newState = Object.assign(this.initialState, nextProps.entry)\n        for (const key of this.entryKeys) {\n            if (this.props.entry[key] === nextProps.entry[key]) {\n                newState[key] = this.state[key]\n            }\n        }\n        this.setState(newState)\n    }\n\n    delete = async () => {\n        if (!window.confirm(`Are you sure you want to delete ${this.state.id}?`)) {\n            return\n        }\n        this.setState({ deleting: true })\n        const resp = await this.deleteFunc(this.state.id)\n        if (resp.success) {\n            this.props.history.push(\"/\")\n            this.props.onDelete()\n        } else {\n            this.setState({ deleting: false, error: resp.error })\n        }\n    }\n\n    get entryKeys() {\n        return []\n    }\n\n    get initialState() {\n        return {}\n    }\n\n    get hasInstances() {\n        return this.state.instances && this.state.instances.length > 0\n    }\n\n    get isNew() {\n        return !this.props.entry.id\n    }\n\n    inputChange = event => {\n        if (!event.target.name) {\n            return\n        }\n        this.setState({ [event.target.name]: event.target.value })\n    }\n\n    async readFile(file) {\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader()\n            reader.readAsArrayBuffer(file)\n            reader.onload = evt => resolve(evt.target.result)\n            reader.onerror = err => reject(err)\n        })\n    }\n\n    renderInstances = () => !this.isNew && (\n        <div className=\"instances\">\n            <h3>{this.hasInstances ? \"Instances\" : \"No instances :(\"}</h3>\n            {this.state.instances.map(instance => (\n                <Link className=\"instance\" key={instance.id} to={`/instance/${instance.id}`}>\n                    {instance.id}\n                </Link>\n            ))}\n        </div>\n    )\n\n    renderLogButton = (filter) => !this.isNew && api.getFeatures().log && <div className=\"buttons\">\n        <button className=\"open-log\" onClick={() => this.props.openLog(filter)}>View logs</button>\n    </div>\n}\n\nexport default BaseMainView\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from \"react\";\n\nvar _ref = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z\"\n});\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M0 0h24v24H0z\",\n  fill: \"none\"\n});\n\nconst SvgChevronLeft = ({\n  svgRef,\n  title,\n  ...props\n}) => /*#__PURE__*/React.createElement(\"svg\", _extends({\n  width: 24,\n  height: 24,\n  viewBox: \"0 0 24 24\",\n  ref: svgRef\n}, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref, _ref2);\n\nconst ForwardRef = /*#__PURE__*/React.forwardRef((props, ref) => /*#__PURE__*/React.createElement(SvgChevronLeft, _extends({\n  svgRef: ref\n}, props)));\nexport default __webpack_public_path__ + \"static/media/chevron-left.7e77da69.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from \"react\";\n\nvar _ref = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M7 10l5 5 5-5z\"\n});\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M0 0h24v24H0z\",\n  fill: \"none\"\n});\n\nconst SvgSortDown = ({\n  svgRef,\n  title,\n  ...props\n}) => /*#__PURE__*/React.createElement(\"svg\", _extends({\n  width: 24,\n  height: 24,\n  viewBox: \"0 0 24 24\",\n  ref: svgRef\n}, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref, _ref2);\n\nconst ForwardRef = /*#__PURE__*/React.forwardRef((props, ref) => /*#__PURE__*/React.createElement(SvgSortDown, _extends({\n  svgRef: ref\n}, props)));\nexport default __webpack_public_path__ + \"static/media/sort-down.ebe1c3a6.svg\";\nexport { ForwardRef as ReactComponent };","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from \"react\";\n\nvar _ref = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M7 14l5-5 5 5z\"\n});\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M0 0h24v24H0z\",\n  fill: \"none\"\n});\n\nconst SvgSortUp = ({\n  svgRef,\n  title,\n  ...props\n}) => /*#__PURE__*/React.createElement(\"svg\", _extends({\n  width: 24,\n  height: 24,\n  viewBox: \"0 0 24 24\",\n  ref: svgRef\n}, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref, _ref2);\n\nconst ForwardRef = /*#__PURE__*/React.forwardRef((props, ref) => /*#__PURE__*/React.createElement(SvgSortUp, _extends({\n  svgRef: ref\n}, props)));\nexport default __webpack_public_path__ + \"static/media/sort-up.4bff7167.svg\";\nexport { ForwardRef as ReactComponent };","// maubot - A plugin-based Matrix bot system.\n// Copyright (C) 2019 Tulir Asokan\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\nimport React, { Component } from \"react\"\nimport { NavLink, Link, withRouter } from \"react-router-dom\"\nimport { ContextMenu, ContextMenuTrigger, MenuItem } from \"react-contextmenu\"\nimport { ReactComponent as ChevronLeft } from \"../../res/chevron-left.svg\"\nimport { ReactComponent as OrderDesc } from \"../../res/sort-down.svg\"\nimport { ReactComponent as OrderAsc } from \"../../res/sort-up.svg\"\nimport api from \"../../api\"\nimport Spinner from \"../../components/Spinner\"\n\n// eslint-disable-next-line no-extend-native\nMap.prototype.map = function(func) {\n    const res = []\n    for (const [key, value] of this) {\n        res.push(func(value, key, this))\n    }\n    return res\n}\n\nclass InstanceDatabase extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            tables: null,\n            header: null,\n            content: null,\n            query: \"\",\n            selectedTable: null,\n\n            error: null,\n\n            prevQuery: null,\n            rowCount: null,\n            insertedPrimaryKey: null,\n        }\n        this.order = new Map()\n    }\n\n    async componentWillMount() {\n        const tables = new Map(Object.entries(await api.getInstanceDatabase(this.props.instanceID)))\n        for (const [name, table] of tables) {\n            table.name = name\n            table.columns = new Map(Object.entries(table.columns))\n            for (const [columnName, column] of table.columns) {\n                column.name = columnName\n                column.sort = null\n            }\n        }\n        this.setState({ tables })\n        this.checkLocationTable()\n    }\n\n    componentDidUpdate(prevProps) {\n        if (this.props.location !== prevProps.location) {\n            this.order = new Map()\n            this.setState({ header: null, content: null })\n            this.checkLocationTable()\n        }\n    }\n\n    checkLocationTable() {\n        const prefix = `/instance/${this.props.instanceID}/database/`\n        if (this.props.location.pathname.startsWith(prefix)) {\n            const table = this.props.location.pathname.substr(prefix.length)\n            this.setState({ selectedTable: table })\n            this.buildSQLQuery(table)\n        }\n    }\n\n    getSortQueryParams(table) {\n        const order = []\n        for (const [column, sort] of Array.from(this.order.entries()).reverse()) {\n            order.push(`order=${column}:${sort}`)\n        }\n        return order\n    }\n\n    buildSQLQuery(table = this.state.selectedTable, resetContent = true) {\n        let query = `SELECT * FROM \"${table}\"`\n\n        if (this.order.size > 0) {\n            const order = Array.from(this.order.entries()).reverse()\n                .map(([column, sort]) => `${column} ${sort}`)\n            query += ` ORDER BY ${order.join(\", \")}`\n        }\n\n        query += \" LIMIT 100\"\n        this.setState({ query }, () => this.reloadContent(resetContent))\n    }\n\n    reloadContent = async (resetContent = true) => {\n        this.setState({ loading: true })\n        const res = await api.queryInstanceDatabase(this.props.instanceID, this.state.query)\n        this.setState({ loading: false })\n        if (resetContent) {\n            this.setState({\n                prevQuery: null,\n                rowCount: null,\n                insertedPrimaryKey: null,\n                error: null,\n            })\n        }\n        if (!res.ok) {\n            this.setState({\n                error: res.error,\n            })\n        } else if (res.rows) {\n            this.setState({\n                header: res.columns,\n                content: res.rows,\n            })\n        } else {\n            this.setState({\n                prevQuery: res.query,\n                rowCount: res.rowcount,\n                insertedPrimaryKey: res.insertedPrimaryKey,\n            })\n            this.buildSQLQuery(this.state.selectedTable, false)\n        }\n    }\n\n    toggleSort(column) {\n        const oldSort = this.order.get(column) || \"auto\"\n        this.order.delete(column)\n        switch (oldSort) {\n        case \"auto\":\n            this.order.set(column, \"DESC\")\n            break\n        case \"DESC\":\n            this.order.set(column, \"ASC\")\n            break\n        case \"ASC\":\n        default:\n            break\n        }\n        this.buildSQLQuery()\n    }\n\n    getSortIcon(column) {\n        switch (this.order.get(column)) {\n        case \"DESC\":\n            return <OrderDesc/>\n        case \"ASC\":\n            return <OrderAsc/>\n        default:\n            return null\n        }\n    }\n\n    getColumnInfo(columnName) {\n        const table = this.state.tables.get(this.state.selectedTable)\n        if (!table) {\n            return null\n        }\n        const column = table.columns.get(columnName)\n        if (!column) {\n            return null\n        }\n        if (column.primary) {\n            return <span className=\"meta\">&nbsp;(pk)</span>\n        } else if (column.unique) {\n            return <span className=\"meta\">&nbsp;(u)</span>\n        }\n        return null\n    }\n\n    getColumnType(columnName) {\n        const table = this.state.tables.get(this.state.selectedTable)\n        if (!table) {\n            return null\n        }\n        const column = table.columns.get(columnName)\n        if (!column) {\n            return null\n        }\n        return column.type\n    }\n\n    deleteRow = async (_, data) => {\n        const values = this.state.content[data.row]\n        const keys = this.state.header\n        const condition = []\n        for (const [index, key] of Object.entries(keys)) {\n            const val = values[index]\n            condition.push(`${key}='${this.sqlEscape(val.toString())}'`)\n        }\n        const query = `DELETE FROM \"${this.state.selectedTable}\" WHERE ${condition.join(\" AND \")}`\n        const res = await api.queryInstanceDatabase(this.props.instanceID, query)\n        this.setState({\n            prevQuery: `DELETE FROM \"${this.state.selectedTable}\" ...`,\n            rowCount: res.rowcount,\n        })\n        await this.reloadContent(false)\n    }\n\n    editCell = async (evt, data) => {\n        console.log(\"Edit\", data)\n    }\n\n    collectContextMeta = props => ({\n        row: props.row,\n        col: props.col,\n    })\n\n    // eslint-disable-next-line no-control-regex\n    sqlEscape = str => str.replace(/[\\0\\x08\\x09\\x1a\\n\\r\"'\\\\%]/g, char => {\n        switch (char) {\n        case \"\\0\":\n            return \"\\\\0\"\n        case \"\\x08\":\n            return \"\\\\b\"\n        case \"\\x09\":\n            return \"\\\\t\"\n        case \"\\x1a\":\n            return \"\\\\z\"\n        case \"\\n\":\n            return \"\\\\n\"\n        case \"\\r\":\n            return \"\\\\r\"\n        case \"\\\"\":\n        case \"'\":\n        case \"\\\\\":\n        case \"%\":\n            return \"\\\\\" + char\n        default:\n            return char\n        }\n    })\n\n    renderTable = () => <div className=\"table\">\n        {this.state.header ? <>\n            <table>\n                <thead>\n                    <tr>\n                        {this.state.header.map(column => (\n                            <td key={column}>\n                                <span onClick={() => this.toggleSort(column)}\n                                      title={this.getColumnType(column)}>\n                                    <strong>{column}</strong>\n                                    {this.getColumnInfo(column)}\n                                    {this.getSortIcon(column)}\n                                </span>\n                            </td>\n                        ))}\n                    </tr>\n                </thead>\n                <tbody>\n                    {this.state.content.map((row, rowIndex) => (\n                        <tr key={rowIndex}>\n                            {row.map((cell, colIndex) => (\n                                <ContextMenuTrigger key={colIndex} id=\"database_table_menu\"\n                                                    renderTag=\"td\" row={rowIndex} col={colIndex}\n                                                    collect={this.collectContextMeta}>\n                                    {cell}\n                                </ContextMenuTrigger>\n                            ))}\n                        </tr>\n                    ))}\n                </tbody>\n            </table>\n            <ContextMenu id=\"database_table_menu\">\n                <MenuItem onClick={this.deleteRow}>Delete row</MenuItem>\n                <MenuItem disabled onClick={this.editCell}>Edit cell</MenuItem>\n            </ContextMenu>\n        </> : this.state.loading ? <Spinner/> : null}\n    </div>\n\n    renderContent() {\n        return <>\n            <div className=\"tables\">\n                {this.state.tables.map((_, tbl) => (\n                    <NavLink key={tbl} to={`/instance/${this.props.instanceID}/database/${tbl}`}>\n                        {tbl}\n                    </NavLink>\n                ))}\n            </div>\n            <div className=\"query\">\n                <input type=\"text\" value={this.state.query} name=\"query\"\n                       onChange={evt => this.setState({ query: evt.target.value })}/>\n                <button type=\"submit\" onClick={this.reloadContent}>Query</button>\n            </div>\n            {this.state.error && <div className=\"error\">\n                {this.state.error}\n            </div>}\n            {this.state.prevQuery && <div className=\"prev-query\">\n                <p>\n                    Executed <span className=\"query\">{this.state.prevQuery}</span> -\n                    affected <strong>{this.state.rowCount} rows</strong>.\n                </p>\n                {this.state.insertedPrimaryKey && <p className=\"inserted-primary-key\">\n                    Inserted primary key: {this.state.insertedPrimaryKey}\n                </p>}\n            </div>}\n            {this.renderTable()}\n        </>\n    }\n\n    render() {\n        return <div className=\"instance-database\">\n            <div className=\"topbar\">\n                <Link className=\"topbar\" to={`/instance/${this.props.instanceID}`}>\n                    <ChevronLeft/>\n                    Back\n                </Link>\n            </div>\n            {this.state.tables\n                ? this.renderContent()\n                : <Spinner className=\"maubot-loading\"/>}\n        </div>\n    }\n}\n\nexport default withRouter(InstanceDatabase)\n","// maubot - A plugin-based Matrix bot system.\n// Copyright (C) 2019 Tulir Asokan\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\nimport React from \"react\"\nimport { Link, NavLink, Route, Switch, withRouter } from \"react-router-dom\"\nimport AceEditor from \"react-ace\"\nimport \"ace-builds/src-noconflict/mode-yaml\"\nimport \"ace-builds/src-noconflict/theme-github\"\nimport { ReactComponent as ChevronRight } from \"../../res/chevron-right.svg\"\nimport { ReactComponent as NoAvatarIcon } from \"../../res/bot.svg\"\nimport PrefTable, { PrefInput, PrefSelect, PrefSwitch } from \"../../components/PreferenceTable\"\nimport api from \"../../api\"\nimport Spinner from \"../../components/Spinner\"\nimport BaseMainView from \"./BaseMainView\"\nimport InstanceDatabase from \"./InstanceDatabase\"\n\nconst InstanceListEntry = ({ entry }) => (\n    <NavLink className=\"instance entry\" to={`/instance/${entry.id}`}>\n        <span className=\"id\">{entry.id}</span>\n        <ChevronRight className='chevron'/>\n    </NavLink>\n)\n\nclass Instance extends BaseMainView {\n    static ListEntry = InstanceListEntry\n\n    constructor(props) {\n        super(props)\n        this.deleteFunc = api.deleteInstance\n        this.updateClientOptions()\n    }\n\n    get entryKeys() {\n        return [\"id\", \"primary_user\", \"enabled\", \"started\", \"type\", \"config\"]\n    }\n\n    get initialState() {\n        return {\n            id: \"\",\n            primary_user: \"\",\n            enabled: true,\n            started: true,\n            type: \"\",\n            config: \"\",\n\n            saving: false,\n            deleting: false,\n            error: \"\",\n        }\n    }\n\n    get instanceInState() {\n        const instance = Object.assign({}, this.state)\n        delete instance.saving\n        delete instance.deleting\n        delete instance.error\n        return instance\n    }\n\n    componentWillReceiveProps(nextProps) {\n        super.componentWillReceiveProps(nextProps)\n        this.updateClientOptions()\n    }\n\n    getAvatarMXC(client) {\n        return client.avatar_url === \"disable\" ? client.remote_avatar_url : client.avatar_url\n    }\n\n    getAvatarURL(client) {\n        return api.getAvatarURL({\n            id: client.id,\n            avatar_url: this.getAvatarMXC(client),\n        })\n    }\n\n    clientSelectEntry = client => client && {\n        id: client.id,\n        value: client.id,\n        label: (\n            <div className=\"select-client\">\n                {this.getAvatarMXC(client)\n                    ? <img className=\"avatar\" src={this.getAvatarURL(client)} alt=\"\"/>\n                    : <NoAvatarIcon className='avatar'/>}\n                <span className=\"displayname\">{\n                    (client.displayname === \"disable\"\n                            ? client.remote_displayname\n                            : client.displayname\n                    ) || client.id\n                }</span>\n            </div>\n        ),\n    }\n\n    updateClientOptions() {\n        this.clientOptions = Object.values(this.props.ctx.clients).map(this.clientSelectEntry)\n    }\n\n    save = async () => {\n        this.setState({ saving: true })\n        const resp = await api.putInstance(this.instanceInState, this.props.entry\n            ? this.props.entry.id : undefined)\n        if (resp.id) {\n            if (this.isNew) {\n                this.props.history.push(`/instance/${resp.id}`)\n            } else {\n                if (resp.id !== this.props.entry.id) {\n                    this.props.history.replace(`/instance/${resp.id}`)\n                }\n                this.setState({ saving: false, error: \"\" })\n            }\n            this.props.onChange(resp)\n        } else {\n            this.setState({ saving: false, error: resp.error })\n        }\n    }\n\n    get selectedClientEntry() {\n        return this.state.primary_user\n            ? this.clientSelectEntry(this.props.ctx.clients[this.state.primary_user])\n            : {}\n    }\n\n    get selectedPluginEntry() {\n        return {\n            id: this.state.type,\n            value: this.state.type,\n            label: this.state.type,\n        }\n    }\n\n    get typeOptions() {\n        return Object.values(this.props.ctx.plugins).map(plugin => plugin && {\n            id: plugin.id,\n            value: plugin.id,\n            label: plugin.id,\n        })\n    }\n\n    get loading() {\n        return this.state.deleting || this.state.saving\n    }\n\n    get isValid() {\n        return this.state.id && this.state.primary_user && this.state.type\n    }\n\n    render() {\n        return <Switch>\n            <Route path=\"/instance/:id/database\" render={this.renderDatabase}/>\n            <Route render={this.renderMain}/>\n        </Switch>\n    }\n\n    renderDatabase = () => <InstanceDatabase instanceID={this.props.entry.id}/>\n\n    renderMain = () => <div className=\"instance\">\n        <PrefTable>\n            <PrefInput rowName=\"ID\" type=\"text\" name=\"id\" value={this.state.id}\n                       placeholder=\"fancybotinstance\" onChange={this.inputChange}\n                       disabled={!this.isNew} fullWidth={true} className=\"id\"/>\n            <PrefSwitch rowName=\"Enabled\"\n                        active={this.state.enabled} origActive={this.props.entry.enabled}\n                        onToggle={enabled => this.setState({ enabled })}/>\n            <PrefSwitch rowName=\"Running\"\n                        active={this.state.started} origActive={this.props.entry.started}\n                        onToggle={started => this.setState({ started })}/>\n            {api.getFeatures().client ? (\n                <PrefSelect rowName=\"Primary user\" options={this.clientOptions}\n                            isSearchable={false} value={this.selectedClientEntry}\n                            origValue={this.props.entry.primary_user}\n                            onChange={({ id }) => this.setState({ primary_user: id })}/>\n            ) : (\n                <PrefInput rowName=\"Primary user\" type=\"text\" name=\"primary_user\"\n                           value={this.state.primary_user} placeholder=\"@user:example.com\"\n                           onChange={this.inputChange}/>\n            )}\n            {api.getFeatures().plugin ? (\n                <PrefSelect rowName=\"Type\" options={this.typeOptions} isSearchable={false}\n                            value={this.selectedPluginEntry} origValue={this.props.entry.type}\n                            onChange={({ id }) => this.setState({ type: id })}/>\n            ) : (\n                <PrefInput rowName=\"Type\" type=\"text\" name=\"type\" value={this.state.type}\n                           placeholder=\"xyz.maubot.example\" onChange={this.inputChange}/>\n            )}\n        </PrefTable>\n        {!this.isNew && Boolean(this.props.entry.base_config) &&\n        <AceEditor mode=\"yaml\" theme=\"github\" onChange={config => this.setState({ config })}\n                   name=\"config\" value={this.state.config}\n                   editorProps={{\n                       fontSize: \"10pt\",\n                       $blockScrolling: true,\n                   }}/>}\n        <div className=\"buttons\">\n            {!this.isNew && (\n                <button className=\"delete\" onClick={this.delete} disabled={this.loading}>\n                    {this.state.deleting ? <Spinner/> : \"Delete\"}\n                </button>\n            )}\n            <button className={`save ${this.isValid ? \"\" : \"disabled-bg\"}`}\n                    onClick={this.save} disabled={this.loading || !this.isValid}>\n                {this.state.saving ? <Spinner/> : (this.isNew ? \"Create\" : \"Save\")}\n            </button>\n        </div>\n        {!this.isNew && <div className=\"buttons\">\n            {this.props.entry.database && (\n                <Link className=\"button open-database\"\n                      to={`/instance/${this.state.id}/database`}>\n                    View database\n                </Link>\n            )}\n            {api.getFeatures().log &&\n            <button className=\"open-log\"\n                    onClick={() => this.props.openLog(`instance.${this.state.id}`)}>\n                View logs\n            </button>}\n        </div>}\n        <div className=\"error\">{this.state.error}</div>\n    </div>\n}\n\nexport default withRouter(Instance)\n","function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React from \"react\";\n\nvar _ref = /*#__PURE__*/React.createElement(\"path\", {\n  fill: \"#000000\",\n  d: \"M9,16V10H5L12,3L19,10H15V16H9M5,20V18H19V20H5Z\"\n});\n\nconst SvgUpload = ({\n  svgRef,\n  title,\n  ...props\n}) => /*#__PURE__*/React.createElement(\"svg\", _extends({\n  width: 24,\n  height: 24,\n  viewBox: \"0 0 24 24\",\n  ref: svgRef\n}, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref);\n\nconst ForwardRef = /*#__PURE__*/React.forwardRef((props, ref) => /*#__PURE__*/React.createElement(SvgUpload, _extends({\n  svgRef: ref\n}, props)));\nexport default __webpack_public_path__ + \"static/media/upload.a57b7662.svg\";\nexport { ForwardRef as ReactComponent };","// maubot - A plugin-based Matrix bot system.\n// Copyright (C) 2019 Tulir Asokan\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\nimport React from \"react\"\nimport { NavLink, withRouter } from \"react-router-dom\"\nimport { ReactComponent as ChevronRight } from \"../../res/chevron-right.svg\"\nimport { ReactComponent as UploadButton } from \"../../res/upload.svg\"\nimport { ReactComponent as NoAvatarIcon } from \"../../res/bot.svg\"\nimport { PrefTable, PrefSwitch, PrefInput, PrefSelect } from \"../../components/PreferenceTable\"\nimport Spinner from \"../../components/Spinner\"\nimport api from \"../../api\"\nimport BaseMainView from \"./BaseMainView\"\n\nconst ClientListEntry = ({ entry }) => {\n    const classes = [\"client\", \"entry\"]\n    if (!entry.enabled) {\n        classes.push(\"disabled\")\n    } else if (!entry.started) {\n        classes.push(\"stopped\")\n    }\n    const avatarMXC = entry.avatar_url === \"disable\"\n        ? entry.remote_avatar_url\n        : entry.avatar_url\n    const avatarURL = avatarMXC && api.getAvatarURL({\n        id: entry.id,\n        avatar_url: avatarMXC,\n    })\n    const displayname = (\n        entry.displayname === \"disable\"\n            ? entry.remote_displayname\n            : entry.displayname\n    ) || entry.id\n    return (\n        <NavLink className={classes.join(\" \")} to={`/client/${entry.id}`}>\n            {avatarURL\n                ? <img className='avatar' src={avatarURL} alt=\"\"/>\n                : <NoAvatarIcon className='avatar'/>}\n            <span className=\"displayname\">{displayname}</span>\n            <ChevronRight className='chevron'/>\n        </NavLink>\n    )\n}\n\nclass Client extends BaseMainView {\n    static ListEntry = ClientListEntry\n\n    constructor(props) {\n        super(props)\n        this.deleteFunc = api.deleteClient\n        this.homeserverOptions = {}\n    }\n\n    get entryKeys() {\n        return [\"id\", \"displayname\", \"homeserver\", \"avatar_url\", \"access_token\", \"sync\",\n            \"autojoin\", \"online\", \"enabled\", \"started\"]\n    }\n\n    get initialState() {\n        return {\n            id: \"\",\n            displayname: \"\",\n            homeserver: \"\",\n            avatar_url: \"\",\n            access_token: \"\",\n            sync: true,\n            autojoin: true,\n            enabled: true,\n            online: true,\n            started: false,\n\n            instances: [],\n\n            uploadingAvatar: false,\n            saving: false,\n            deleting: false,\n            startingOrStopping: false,\n            clearingCache: false,\n            error: \"\",\n        }\n    }\n\n    get clientInState() {\n        const client = Object.assign({}, this.state)\n        delete client.uploadingAvatar\n        delete client.saving\n        delete client.deleting\n        delete client.startingOrStopping\n        delete client.clearingCache\n        delete client.error\n        delete client.instances\n        return client\n    }\n\n    get selectedHomeserver() {\n        return this.state.homeserver\n            ? this.homeserverEntry([this.props.ctx.homeserversByURL[this.state.homeserver],\n                this.state.homeserver])\n            : {}\n    }\n\n    homeserverEntry = ([serverName, serverURL]) => serverURL && {\n        id: serverURL,\n        value: serverURL,\n        label: serverName || serverURL,\n    }\n\n    componentWillReceiveProps(nextProps) {\n        super.componentWillReceiveProps(nextProps)\n        this.updateHomeserverOptions()\n    }\n\n    updateHomeserverOptions() {\n        this.homeserverOptions = Object.entries(this.props.ctx.homeserversByName).map(this.homeserverEntry)\n    }\n\n    isValidHomeserver(value) {\n        try {\n            return Boolean(new URL(value))\n        } catch (err) {\n            return false\n        }\n    }\n\n    avatarUpload = async event => {\n        const file = event.target.files[0]\n        this.setState({\n            uploadingAvatar: true,\n        })\n        const data = await this.readFile(file)\n        const resp = await api.uploadAvatar(this.state.id, data, file.type)\n        this.setState({\n            uploadingAvatar: false,\n            avatar_url: resp.content_uri,\n        })\n    }\n\n    save = async () => {\n        this.setState({ saving: true })\n        const resp = await api.putClient(this.clientInState)\n        if (resp.id) {\n            if (this.isNew) {\n                this.props.history.push(`/client/${resp.id}`)\n            } else {\n                this.setState({ saving: false, error: \"\" })\n            }\n            this.props.onChange(resp)\n        } else {\n            this.setState({ saving: false, error: resp.error })\n        }\n    }\n\n    startOrStop = async () => {\n        this.setState({ startingOrStopping: true })\n        const resp = await api.putClient({\n            id: this.props.entry.id,\n            started: !this.props.entry.started,\n        })\n        if (resp.id) {\n            this.props.onChange(resp)\n            this.setState({ startingOrStopping: false, error: \"\" })\n        } else {\n            this.setState({ startingOrStopping: false, error: resp.error })\n        }\n    }\n\n    clearCache = async () => {\n        this.setState({ clearingCache: true })\n        const resp = await api.clearClientCache(this.props.entry.id)\n        if (resp.success) {\n            this.setState({ clearingCache: false, error: \"\" })\n        } else {\n            this.setState({ clearingCache: false, error: resp.error })\n        }\n    }\n\n    get loading() {\n        return this.state.saving || this.state.startingOrStopping || this.clearingCache || this.state.deleting\n    }\n\n    renderStartedContainer = () => {\n        let text\n        if (this.props.entry.started) {\n            if (this.props.entry.sync_ok) {\n                text = \"Started\"\n            } else {\n                text = \"Erroring\"\n            }\n        } else if (this.props.entry.enabled) {\n            text = \"Stopped\"\n        } else {\n            text = \"Disabled\"\n        }\n        return <div className=\"started-container\">\n            <span className={`started ${this.props.entry.started}\n                             ${this.props.entry.sync_ok ? \"sync_ok\" : \"sync_error\"}\n                             ${this.props.entry.enabled ? \"\" : \"disabled\"}`}/>\n            <span className=\"text\">{text}</span>\n        </div>\n    }\n\n    get avatarMXC() {\n        return this.state.avatar_url === \"disable\" ? this.props.entry.remote_avatar_url : this.state.avatar_url\n    }\n\n    get avatarURL() {\n        return api.getAvatarURL({\n            id: this.state.id,\n            avatar_url: this.avatarMXC,\n        })\n    }\n\n    renderSidebar = () => !this.isNew && (\n        <div className=\"sidebar\">\n            <div className={`avatar-container ${this.avatarMXC ? \"\" : \"no-avatar\"}\n                        ${this.state.uploadingAvatar ? \"uploading\" : \"\"}`}>\n                {this.avatarMXC && <img className=\"avatar\" src={this.avatarURL} alt=\"Avatar\"/>}\n                <UploadButton className=\"upload\"/>\n                <input className=\"file-selector\" type=\"file\" accept=\"image/png, image/jpeg\"\n                       onChange={this.avatarUpload} disabled={this.state.uploadingAvatar}\n                       onDragEnter={evt => evt.target.parentElement.classList.add(\"drag\")}\n                       onDragLeave={evt => evt.target.parentElement.classList.remove(\"drag\")}/>\n                {this.state.uploadingAvatar && <Spinner/>}\n            </div>\n            {this.renderStartedContainer()}\n            {(this.props.entry.started || this.props.entry.enabled) && <>\n                <button className=\"save\" onClick={this.startOrStop} disabled={this.loading}>\n                    {this.state.startingOrStopping ? <Spinner/>\n                        : (this.props.entry.started ? \"Stop\" : \"Start\")}\n                </button>\n                <button className=\"clearcache\" onClick={this.clearCache} disabled={this.loading}>\n                    {this.state.clearingCache ? <Spinner/> : \"Clear cache\"}\n                </button>\n            </>}\n        </div>\n    )\n\n    renderPreferences = () => (\n        <PrefTable>\n            <PrefInput rowName=\"User ID\" type=\"text\" disabled={!this.isNew} fullWidth={true}\n                       name={this.isNew ? \"id\" : \"\"} className=\"id\"\n                       value={this.state.id} origValue={this.props.entry.id}\n                       placeholder=\"@fancybot:example.com\" onChange={this.inputChange}/>\n            {api.getFeatures().client_auth ? (\n                <PrefSelect rowName=\"Homeserver\" options={this.homeserverOptions}\n                            isSearchable={true} value={this.selectedHomeserver}\n                            origValue={this.props.entry.homeserver}\n                            onChange={({ value }) => this.setState({ homeserver: value })}\n                            creatable={true} isValidNewOption={this.isValidHomeserver}/>\n            ) : (\n                <PrefInput rowName=\"Homeserver\" type=\"text\" name=\"homeserver\"\n                           value={this.state.homeserver} origValue={this.props.entry.homeserver}\n                           placeholder=\"https://example.com\" onChange={this.inputChange}/>\n            )}\n            <PrefInput rowName=\"Access token\" type=\"text\" name=\"access_token\"\n                       value={this.state.access_token} origValue={this.props.entry.access_token}\n                       placeholder=\"MDAxYWxvY2F0aW9uIG1hdHJpeC5sb2NhbAowMDEzaWRlbnRpZmllc\"\n                       onChange={this.inputChange}/>\n            <PrefInput rowName=\"Display name\" type=\"text\" name=\"displayname\"\n                       value={this.state.displayname} origValue={this.props.entry.displayname}\n                       placeholder=\"My fancy bot\" onChange={this.inputChange}/>\n            <PrefInput rowName=\"Avatar URL\" type=\"text\" name=\"avatar_url\"\n                       value={this.state.avatar_url} origValue={this.props.entry.avatar_url}\n                       placeholder=\"mxc://example.com/mbmwyoTvPhEQPiCskcUsppko\"\n                       onChange={this.inputChange}/>\n            <PrefSwitch rowName=\"Sync\"\n                        active={this.state.sync} origActive={this.props.entry.sync}\n                        onToggle={sync => this.setState({ sync })}/>\n            <PrefSwitch rowName=\"Autojoin\"\n                        active={this.state.autojoin} origActive={this.props.entry.autojoin}\n                        onToggle={autojoin => this.setState({ autojoin })}/>\n            <PrefSwitch rowName=\"Enabled\"\n                        active={this.state.enabled} origActive={this.props.entry.enabled}\n                        onToggle={enabled => this.setState({\n                            enabled,\n                            started: enabled && this.state.started,\n                        })}/>\n            <PrefSwitch rowName=\"Online\"\n                        active={this.state.online} origActive={this.props.entry.online}\n                        onToggle={online => this.setState({ online })} />\n        </PrefTable>\n    )\n\n    renderPrefButtons = () => <>\n        <div className=\"buttons\">\n            {!this.isNew && (\n                <button className={`delete ${this.hasInstances ? \"disabled-bg\" : \"\"}`}\n                        onClick={this.delete} disabled={this.loading || this.hasInstances}\n                        title={this.hasInstances ? \"Can't delete client that is in use\" : \"\"}>\n                    {this.state.deleting ? <Spinner/> : \"Delete\"}\n                </button>\n            )}\n            <button className=\"save\" onClick={this.save} disabled={this.loading}>\n                {this.state.saving ? <Spinner/> : (this.isNew ? \"Create\" : \"Save\")}\n            </button>\n        </div>\n        {this.renderLogButton(this.state.id)}\n        <div className=\"error\">{this.state.error}</div>\n    </>\n\n    render() {\n        return <>\n            <div className=\"client\">\n                {this.renderSidebar()}\n                <div className=\"info\">\n                    {this.renderPreferences()}\n                    {this.renderPrefButtons()}\n                    {this.renderInstances()}\n                </div>\n            </div>\n        </>\n    }\n}\n\nexport default withRouter(Client)\n","// maubot - A plugin-based Matrix bot system.\n// Copyright (C) 2019 Tulir Asokan\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\nimport React from \"react\"\nimport { NavLink, withRouter } from \"react-router-dom\"\nimport { ReactComponent as ChevronRight } from \"../../res/chevron-right.svg\"\nimport { ReactComponent as UploadButton } from \"../../res/upload.svg\"\nimport PrefTable, { PrefInput } from \"../../components/PreferenceTable\"\nimport Spinner from \"../../components/Spinner\"\nimport api from \"../../api\"\nimport BaseMainView from \"./BaseMainView\"\n\nconst PluginListEntry = ({ entry }) => (\n    <NavLink className=\"plugin entry\" to={`/plugin/${entry.id}`}>\n        <span className=\"id\">{entry.id}</span>\n        <ChevronRight className='chevron'/>\n    </NavLink>\n)\n\n\nclass Plugin extends BaseMainView {\n    static ListEntry = PluginListEntry\n\n    constructor(props) {\n        super(props)\n        this.deleteFunc = api.deletePlugin\n    }\n\n    get initialState() {\n        return {\n            id: \"\",\n            version: \"\",\n\n            instances: [],\n\n            uploading: false,\n            deleting: false,\n            error: \"\",\n        }\n    }\n\n    upload = async event => {\n        const file = event.target.files[0]\n        this.setState({\n            uploadingAvatar: true,\n        })\n        const data = await this.readFile(file)\n        const resp = await api.uploadPlugin(data, this.state.id)\n        if (resp.id) {\n            if (this.isNew) {\n                this.props.history.push(`/plugin/${resp.id}`)\n            } else {\n                this.setState({ saving: false, error: \"\" })\n            }\n            this.props.onChange(resp)\n        } else {\n            this.setState({ saving: false, error: resp.error })\n        }\n    }\n\n    render() {\n        return <div className=\"plugin\">\n            {!this.isNew && <PrefTable>\n                <PrefInput rowName=\"ID\" type=\"text\" value={this.state.id} disabled={true}\n                           className=\"id\"/>\n                <PrefInput rowName=\"Version\" type=\"text\" value={this.state.version}\n                           disabled={true}/>\n            </PrefTable>}\n            {api.getFeatures().plugin_upload &&\n            <div className={`upload-box ${this.state.uploading ? \"uploading\" : \"\"}`}>\n                <UploadButton className=\"upload\"/>\n                <input className=\"file-selector\" type=\"file\" accept=\"application/zip+mbp\"\n                       onChange={this.upload} disabled={this.state.uploading || this.state.deleting}\n                       onDragEnter={evt => evt.target.parentElement.classList.add(\"drag\")}\n                       onDragLeave={evt => evt.target.parentElement.classList.remove(\"drag\")}/>\n                {this.state.uploading && <Spinner/>}\n            </div>}\n            {!this.isNew && <div className=\"buttons\">\n                <button className={`delete ${this.hasInstances ? \"disabled-bg\" : \"\"}`}\n                        onClick={this.delete} disabled={this.loading || this.hasInstances}\n                        title={this.hasInstances ? \"Can't delete plugin that is in use\" : \"\"}>\n                    {this.state.deleting ? <Spinner/> : \"Delete\"}\n                </button>\n            </div>}\n            {this.renderLogButton(\"loader.zip\")}\n            <div className=\"error\">{this.state.error}</div>\n            {this.renderInstances()}\n        </div>\n    }\n}\n\nexport default withRouter(Plugin)\n","// maubot - A plugin-based Matrix bot system.\n// Copyright (C) 2019 Tulir Asokan\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\nimport React, { Component } from \"react\"\n\nclass Home extends Component {\n    render() {\n        return <>\n            <div className=\"home\">\n                See sidebar to get started\n            </div>\n            <div className=\"buttons\">\n            </div>\n        </>\n    }\n}\n\nexport default Home\n","// maubot - A plugin-based Matrix bot system.\n// Copyright (C) 2019 Tulir Asokan\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\nimport React, { Component, createContext } from \"react\"\n\nconst rem = 16\n\nclass Modal extends Component {\n    static Context = createContext(null)\n\n    constructor(props) {\n        super(props)\n        this.state = {\n            open: false,\n        }\n        this.wrapper = { clientWidth: 9001 }\n    }\n\n    open = () => this.setState({ open: true })\n    close = () => this.setState({ open: false })\n    isOpen = () => this.state.open\n\n    render() {\n        return this.state.open && (\n            <div className=\"modal-wrapper-wrapper\" ref={ref => this.wrapper = ref}\n                 onClick={() => this.wrapper.clientWidth > 45 * rem && this.close()}>\n                <div className=\"modal-wrapper\" onClick={evt => evt.stopPropagation()}>\n                    <button className=\"close\" onClick={this.close}>Close</button>\n                    <div className=\"modal\">\n                        <Modal.Context.Provider value={this}>\n                            {this.props.children}\n                        </Modal.Context.Provider>\n                    </div>\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default Modal\n","// maubot - A plugin-based Matrix bot system.\n// Copyright (C) 2019 Tulir Asokan\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\nimport React, { PureComponent } from \"react\"\nimport { Link } from \"react-router-dom\"\nimport JSONTree from \"react-json-tree\"\nimport api from \"../../api\"\nimport Modal from \"./Modal\"\n\nclass LogEntry extends PureComponent {\n    static contextType = Modal.Context\n\n    renderName() {\n        const line = this.props.line\n        if (line.nameLink) {\n            const modal = this.context\n            return (\n                <Link to={line.nameLink} onClick={modal.close}>\n                    {line.name}\n                </Link>\n            )\n        }\n        return line.name\n    }\n\n    renderContent() {\n        if (this.props.line.matrix_http_request) {\n            const req = this.props.line.matrix_http_request\n\n            return <>\n                {req.method} {req.path}\n                <div className=\"content\">\n                    {Object.entries(req.content).length > 0\n                    && <JSONTree data={{ content: req.content }} hideRoot={true}/>}\n                </div>\n            </>\n        }\n        return this.props.line.msg\n    }\n\n    onClickOpen(path, line) {\n        return () => {\n            if (api.debugOpenFileEnabled()) {\n                api.debugOpenFile(path, line)\n            }\n            return false\n        }\n    }\n\n    renderTimeTitle() {\n        return this.props.line.time.toDateString()\n    }\n\n    renderTime() {\n        return <a className=\"time\" title={this.renderTimeTitle()}\n                  href={`file:///${this.props.line.pathname}:${this.props.line.lineno}`}\n                  onClick={this.onClickOpen(this.props.line.pathname, this.props.line.lineno)}>\n            {this.props.line.time.toLocaleTimeString(\"en-GB\")}\n        </a>\n    }\n\n    renderLevelName() {\n        return <span className=\"level\">\n            {this.props.line.levelname}\n        </span>\n    }\n\n    get unfocused() {\n        return this.props.focus && this.props.line.name !== this.props.focus\n            ? \"unfocused\"\n            : \"\"\n    }\n\n    renderRow(content) {\n        return (\n            <div className={`row ${this.props.line.levelname.toLowerCase()} ${this.unfocused}`}>\n                {this.renderTime()}\n                {this.renderLevelName()}\n                <span className=\"logger\">{this.renderName()}</span>\n                <span className=\"text\">{content}</span>\n            </div>\n        )\n    }\n\n    renderExceptionInfo() {\n        if (!api.debugOpenFileEnabled()) {\n            return this.props.line.exc_info\n        }\n        const fileLinks = []\n        let str = this.props.line.exc_info.replace(\n            /File \"(.+)\", line ([0-9]+), in (.+)/g,\n            (_, file, line, method) => {\n                fileLinks.push(\n                    <a href={`file:///${file}:${line}`} onClick={this.onClickOpen(file, line)}>\n                        File \"{file}\", line {line}, in {method}\n                    </a>,\n                )\n                return \"||EDGE||\"\n            })\n        fileLinks.reverse()\n\n        const result = []\n        let key = 0\n        for (const part of str.split(\"||EDGE||\")) {\n            result.push(<React.Fragment key={key++}>\n                {part}\n                {fileLinks.pop()}\n            </React.Fragment>)\n        }\n        return result\n    }\n\n    render() {\n        return <>\n            {this.renderRow(this.renderContent())}\n            {this.props.line.exc_info && this.renderRow(this.renderExceptionInfo())}\n        </>\n    }\n}\n\nclass Log extends PureComponent {\n    constructor(props) {\n        super(props)\n\n        this.linesRef = React.createRef()\n        this.linesBottomRef = React.createRef()\n    }\n\n    getSnapshotBeforeUpdate() {\n        if (this.linesRef.current && this.linesBottomRef.current) {\n            return Log.isVisible(this.linesRef.current, this.linesBottomRef.current)\n        }\n        return false\n    }\n\n\n    componentDidUpdate(_1, _2, wasVisible) {\n        if (wasVisible) {\n            Log.scrollParentToChild(this.linesRef.current, this.linesBottomRef.current)\n        }\n    }\n\n    componentDidMount() {\n        if (this.linesRef.current && this.linesBottomRef.current) {\n            Log.scrollParentToChild(this.linesRef.current, this.linesBottomRef.current)\n        }\n    }\n\n    static scrollParentToChild(parent, child) {\n        const parentRect = parent.getBoundingClientRect()\n        const childRect = child.getBoundingClientRect()\n\n        if (!Log.isVisible(parent, child)) {\n            parent.scrollBy({ top: (childRect.top + parent.scrollTop) - parentRect.top })\n        }\n    }\n\n    static isVisible(parent, child) {\n        const parentRect = parent.getBoundingClientRect()\n        const childRect = child.getBoundingClientRect()\n        return (childRect.top >= parentRect.top)\n            && (childRect.top <= parentRect.top + parent.clientHeight)\n    }\n\n    render() {\n        return (\n            <div className=\"log\" ref={this.linesRef}>\n                <div className=\"lines\">\n                    {this.props.lines.map(data => <LogEntry key={data.id} line={data}\n                                                            focus={this.props.focus}/>)}\n                </div>\n                <div ref={this.linesBottomRef}/>\n            </div>\n        )\n    }\n}\n\nexport default Log\n","// maubot - A plugin-based Matrix bot system.\n// Copyright (C) 2019 Tulir Asokan\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\nimport React, { Component } from \"react\"\nimport { Route, Switch, Link, withRouter } from \"react-router-dom\"\nimport api from \"../../api\"\nimport { ReactComponent as Plus } from \"../../res/plus.svg\"\nimport Instance from \"./Instance\"\nimport Client from \"./Client\"\nimport Plugin from \"./Plugin\"\nimport Home from \"./Home\"\nimport Log from \"./Log\"\nimport Modal from \"./Modal\"\n\nclass Dashboard extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            instances: {},\n            clients: {},\n            plugins: {},\n            homeserversByName: {},\n            homeserversByURL: {},\n            sidebarOpen: false,\n            modalOpen: false,\n            logFocus: null,\n            logLines: [],\n        }\n        this.logModal = {\n            open: () => undefined,\n            isOpen: () => false,\n        }\n        window.maubot = this\n    }\n\n    componentDidUpdate(prevProps) {\n        if (this.props.location !== prevProps.location) {\n            this.setState({ sidebarOpen: false })\n        }\n    }\n\n    async componentWillMount() {\n        const [instanceList, clientList, pluginList, homeservers] = await Promise.all([\n            api.getInstances(), api.getClients(), api.getPlugins(), api.getClientAuthServers(),\n            api.updateDebugOpenFileEnabled()])\n        const instances = {}\n        if (api.getFeatures().instance) {\n            for (const instance of instanceList) {\n                instances[instance.id] = instance\n            }\n        }\n        const clients = {}\n        if (api.getFeatures().client) {\n            for (const client of clientList) {\n                clients[client.id] = client\n            }\n        }\n        const plugins = {}\n        if (api.getFeatures().plugin) {\n            for (const plugin of pluginList) {\n                plugins[plugin.id] = plugin\n            }\n        }\n        const homeserversByName = homeservers\n        const homeserversByURL = {}\n        if (api.getFeatures().client_auth) {\n            for (const [key, value] of Object.entries(homeservers)) {\n                homeserversByURL[value] = key\n            }\n        }\n        this.setState({ instances, clients, plugins, homeserversByName, homeserversByURL })\n\n        await this.enableLogs()\n    }\n\n    async enableLogs() {\n        if (!api.getFeatures().log) {\n            return\n        }\n\n        const logs = await api.openLogSocket()\n\n        const processEntry = (entry) => {\n            entry.time = new Date(entry.time)\n            if (entry.name.startsWith(\"maubot.\")) {\n                entry.name = entry.name.substr(\"maubot.\".length)\n            }\n            if (entry.name.startsWith(\"client.\")) {\n                entry.name = entry.name.substr(\"client.\".length)\n                entry.nameLink = `/client/${entry.name}`\n            } else if (entry.name.startsWith(\"instance.\")) {\n                entry.nameLink = `/instance/${entry.name.substr(\"instance.\".length)}`\n            }\n        }\n\n        logs.onHistory = history => {\n            for (const data of history) {\n                processEntry(data)\n            }\n            this.setState({\n                logLines: history,\n            })\n        }\n        logs.onLog = data => {\n            processEntry(data)\n            this.setState({\n                logLines: this.state.logLines.concat(data),\n            })\n        }\n    }\n\n    renderList(field, type) {\n        return this.state[field] && Object.values(this.state[field]).map(entry =>\n            React.createElement(type, { key: entry.id, entry }))\n    }\n\n    delete(stateField, id) {\n        const data = Object.assign({}, this.state[stateField])\n        delete data[id]\n        this.setState({ [stateField]: data })\n    }\n\n    add(stateField, entry, oldID = undefined) {\n        const data = Object.assign({}, this.state[stateField])\n        if (oldID && oldID !== entry.id) {\n            delete data[oldID]\n        }\n        data[entry.id] = entry\n        this.setState({ [stateField]: data })\n    }\n\n    renderView(field, type, id) {\n        const typeName = field.slice(0, -1)\n        if (!api.getFeatures()[typeName]) {\n            return this.renderDisabled(typeName)\n        }\n        const entry = this.state[field][id]\n        if (!entry) {\n            return this.renderNotFound(typeName)\n        }\n        return React.createElement(type, {\n            entry,\n            onDelete: () => this.delete(field, id),\n            onChange: newEntry => this.add(field, newEntry, id),\n            openLog: this.openLog,\n            ctx: this.state,\n        })\n    }\n\n    openLog = filter => {\n        this.setState({\n            logFocus: typeof filter === \"string\" ? filter : null,\n        })\n        this.logModal.open()\n    }\n\n    renderNotFound = (thing = \"path\") => (\n        <div className=\"not-found\">\n            Oops! I'm afraid that {thing} couldn't be found.\n        </div>\n    )\n\n    renderDisabled = (thing = \"path\") => (\n        <div className=\"not-found\">\n            The {thing} API has been disabled in the maubot config.\n        </div>\n    )\n\n    renderMain() {\n        return <div className={`dashboard ${this.state.sidebarOpen ? \"sidebar-open\" : \"\"}`}>\n            <Link to=\"/\" className=\"title\">\n                <img src=\"favicon.png\" alt=\"\"/>\n                Maubot Manager\n            </Link>\n            <div className=\"user\">\n                <span>{localStorage.username}</span>\n            </div>\n\n            <nav className=\"sidebar\">\n                <div className=\"buttons\">\n                    {api.getFeatures().log && <button className=\"open-log\" onClick={this.openLog}>\n                        <span>View logs</span>\n                    </button>}\n                </div>\n                {api.getFeatures().instance && <div className=\"instances list\">\n                    <div className=\"title\">\n                        <h2>Instances</h2>\n                        <Link to=\"/new/instance\"><Plus/></Link>\n                    </div>\n                    {this.renderList(\"instances\", Instance.ListEntry)}\n                </div>}\n                {api.getFeatures().client && <div className=\"clients list\">\n                    <div className=\"title\">\n                        <h2>Clients</h2>\n                        <Link to=\"/new/client\"><Plus/></Link>\n                    </div>\n                    {this.renderList(\"clients\", Client.ListEntry)}\n                </div>}\n                {api.getFeatures().plugin && <div className=\"plugins list\">\n                    <div className=\"title\">\n                        <h2>Plugins</h2>\n                        {api.getFeatures().plugin_upload && <Link to=\"/new/plugin\"><Plus/></Link>}\n                    </div>\n                    {this.renderList(\"plugins\", Plugin.ListEntry)}\n                </div>}\n            </nav>\n\n            <div className=\"topbar\"\n                 onClick={evt => this.setState({ sidebarOpen: !this.state.sidebarOpen })}>\n                <div className={`hamburger ${this.state.sidebarOpen ? \"active\" : \"\"}`}>\n                    <span/><span/><span/>\n                </div>\n            </div>\n\n            <main className=\"view\">\n                <Switch>\n                    <Route path=\"/\" exact render={() => <Home openLog={this.openLog}/>}/>\n                    <Route path=\"/new/instance\" render={() =>\n                        <Instance onChange={newEntry => this.add(\"instances\", newEntry)}\n                                  entry={{}} ctx={this.state}/>}/>\n                    <Route path=\"/new/client\" render={() =>\n                        <Client onChange={newEntry => this.add(\"clients\", newEntry)}\n                                entry={{}} ctx={this.state}/>}/>\n                    <Route path=\"/new/plugin\" render={() =>\n                        <Plugin onChange={newEntry => this.add(\"plugins\", newEntry)}\n                                entry={{}} ctx={this.state}/>}/>\n                    <Route path=\"/instance/:id\" render={({ match }) =>\n                        this.renderView(\"instances\", Instance, match.params.id)}/>\n                    <Route path=\"/client/:id\" render={({ match }) =>\n                        this.renderView(\"clients\", Client, match.params.id)}/>\n                    <Route path=\"/plugin/:id\" render={({ match }) =>\n                        this.renderView(\"plugins\", Plugin, match.params.id)}/>\n                    <Route render={() => this.renderNotFound()}/>\n                </Switch>\n            </main>\n        </div>\n    }\n\n    renderModal() {\n        return <Modal ref={ref => this.logModal = ref}>\n            <Log lines={this.state.logLines} focus={this.state.logFocus}/>\n        </Modal>\n    }\n\n    render() {\n        return <>\n            {this.renderMain()}\n            {this.renderModal()}\n        </>\n    }\n}\n\nexport default withRouter(Dashboard)\n","// maubot - A plugin-based Matrix bot system.\n// Copyright (C) 2019 Tulir Asokan\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\nimport React, { Component } from \"react\"\nimport Spinner from \"../components/Spinner\"\nimport api from \"../api\"\n\nclass Login extends Component {\n    constructor(props, context) {\n        super(props, context)\n        this.state = {\n            username: \"\",\n            password: \"\",\n            loading: false,\n            error: \"\",\n        }\n    }\n\n    inputChanged = event => this.setState({ [event.target.name]: event.target.value })\n\n    login = async evt => {\n        evt.preventDefault()\n        this.setState({ loading: true })\n        const resp = await api.login(this.state.username, this.state.password)\n        if (resp.token) {\n            await this.props.onLogin(resp.token)\n        } else if (resp.error) {\n            this.setState({ error: resp.error, loading: false })\n        } else {\n            this.setState({ error: \"Unknown error\", loading: false })\n            console.log(\"Unknown error:\", resp)\n        }\n    }\n\n    render() {\n        if (!api.getFeatures().login) {\n            return <div className=\"login-wrapper\">\n                <div className=\"login errored\">\n                    <h1>Maubot Manager</h1>\n                    <div className=\"error\">Login has been disabled in the maubot config.</div>\n                </div>\n            </div>\n        }\n        return <div className=\"login-wrapper\">\n            <form className={`login ${this.state.error && \"errored\"}`} onSubmit={this.login}>\n                <h1>Maubot Manager</h1>\n                <input type=\"text\" placeholder=\"Username\" value={this.state.username}\n                       name=\"username\" onChange={this.inputChanged}/>\n                <input type=\"password\" placeholder=\"Password\" value={this.state.password}\n                       name=\"password\" onChange={this.inputChanged}/>\n                <button onClick={this.login} type=\"submit\">\n                    {this.state.loading ? <Spinner/> : \"Log in\"}\n                </button>\n                {this.state.error && <div className=\"error\">{this.state.error}</div>}\n            </form>\n        </div>\n    }\n}\n\nexport default Login\n","// maubot - A plugin-based Matrix bot system.\n// Copyright (C) 2019 Tulir Asokan\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\nimport React, { Component } from \"react\"\nimport { HashRouter as Router, Switch } from \"react-router-dom\"\nimport PrivateRoute from \"../components/PrivateRoute\"\nimport Spinner from \"../components/Spinner\"\nimport api from \"../api\"\nimport Dashboard from \"./dashboard\"\nimport Login from \"./Login\"\n\nclass Main extends Component {\n    constructor(props) {\n        super(props)\n        this.state = {\n            pinged: false,\n            authed: false,\n        }\n    }\n\n    async componentWillMount() {\n        await this.getBasePath()\n        if (localStorage.accessToken) {\n            await this.ping()\n        } else {\n            await api.remoteGetFeatures()\n        }\n        this.setState({ pinged: true })\n    }\n\n    async getBasePath() {\n        try {\n            const resp = await fetch(process.env.PUBLIC_URL + \"/paths.json\", {\n                headers: { \"Content-Type\": \"application/json\" }\n            })\n            const apiPathJson = await resp.json()\n            const apiPath = apiPathJson.api_path\n            api.setBasePath(`${apiPath}`)\n        } catch (err) {\n            console.error(\"Failed to get API path:\", err)\n        }\n    }\n\n\n    async ping() {\n        try {\n            const username = await api.ping()\n            if (username) {\n                localStorage.username = username\n                this.setState({ authed: true })\n            } else {\n                delete localStorage.accessToken\n            }\n        } catch (err) {\n            console.error(err)\n        }\n    }\n\n    login = async (token) => {\n        localStorage.accessToken = token\n        await this.ping()\n    }\n\n    render() {\n        if (!this.state.pinged) {\n            return <Spinner className=\"maubot-loading\"/>\n        }\n        return <Router>\n            <div className={`maubot-wrapper ${this.state.authed ? \"authenticated\" : \"\"}`}>\n                <Switch>\n                    <PrivateRoute path=\"/login\" render={() => <Login onLogin={this.login}/>}\n                                  authed={!this.state.authed} to=\"/\"/>\n                    <PrivateRoute path=\"/\" component={Dashboard} authed={this.state.authed}/>\n                </Switch>\n            </div>\n        </Router>\n    }\n}\n\nexport default Main\n","// maubot - A plugin-based Matrix bot system.\n// Copyright (C) 2019 Tulir Asokan\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\nimport React from \"react\"\nimport ReactDOM from \"react-dom\"\nimport \"./style/index.sass\"\nimport App from \"./pages/Main\"\n\nReactDOM.render(<App/>, document.getElementById(\"root\"))\n"],"sourceRoot":""}